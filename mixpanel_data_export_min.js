if("object"!=typeof window&&"function"==typeof require)var CryptoJS=require("cryptojs").Crypto,XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest;var MixpanelExport=function(){function a(a){if(this.opts=a,!this.opts.api_key||!this.opts.api_secret)throw"Error: api_key and api_secret must be passed to MixpanelExport constructor.";this.api_key=this.opts.api_key,this.api_secret=this.opts.api_secret,this.timeout_after=this.opts.timeout_after||10,this.isNode="object"!=typeof window,this._requestNumber=0}return a.prototype.export=function(a,b){if(!this.isNode)throw new Error(this._jsonpUnsupported("export"));return this.get("export",a,b)},a.prototype.events=function(a,b){return this.get("events",a,b)},a.prototype.topEvents=function(a,b){return this.get(["events","top"],a,b)},a.prototype.names=function(a,b){return this.get(["events","names"],a,b)},a.prototype.properties=function(a,b){return this.get(["events","properties"],a,b)},a.prototype.topProperties=function(a,b){return this.get(["events","properties","top"],a,b)},a.prototype.values=function(a,b){return this.get(["events","properties","values"],a,b)},a.prototype.funnels=function(a,b){return this.get(["funnels"],a,b)},a.prototype.list=function(a,b){return this.get(["funnels","list"],a,b)},a.prototype.segmentation=function(a,b){return this.get(["segmentation"],a,b)},a.prototype.numeric=function(a,b){return this.get(["segmentation","numeric"],a,b)},a.prototype.sum=function(a,b){return this.get(["segmentation","sum"],a,b)},a.prototype.average=function(a,b){return this.get(["segmentation","average"],a,b)},a.prototype.retention=function(a,b){return this.get(["retention"],a,b)},a.prototype.engage=function(a,b){if(!this.isNode)throw new Error(this._jsonpUnsupported("engage"));return this.get(["engage"],a,b)},a.prototype.get=function(a,b,c){var d=this;if(this.isNode||"export"===a){var e=this._buildRequestURL(a,b),f=new XMLHttpRequest,g=function(){var b="export"==a?d._parseExportResult(this.responseText):JSON.parse(this.responseText);return c(b)};f.onload=g,f.open("get",e,!0),f.send()}else{var h=this._getNewRequestNumber(),e=this._buildRequestURL(a,b)+"&callback=mpSuccess"+h,g=function(b){var e="export"==a?d._parseExportResult(b):b;return c(e)};window["mpSuccess"+h]=g;var i=document.createElement("script");i.src=e,document.getElementsByTagName("head")[0].appendChild(i)}},a.prototype._jsonpUnsupported=function(a){return"MixpanelExport: The '"+a+"' method does not support jsonp, and so cannot be used in your browser."},a.prototype._parseExportResult=function(a){var b=a.replace(new RegExp("\n","g"),","),c="["+b+"]",a=c.replace(",]","]");return JSON.parse(a)},a.prototype._buildRequestURL=function(a,b){var c="export"===a?"https://data.mixpanel.com/api/2.0/":"https://mixpanel.com/api/2.0/";return""+c+(("function"==typeof a.join?a.join("/"):void 0)||a)+"/?"+this._requestParameterString(b)},a.prototype._requestParameterString=function(a){var b,c,d;return b=this._extend({api_key:this.api_key,expire:this._timeout()},a),c=this._keys(b).sort(),d=this._without(c,"callback"),this._getParameterString(c,b)+"&sig="+this._getSignature(d,b)},a.prototype._getParameterString=function(a,b){var c=this;return this._map(a,function(a){return""+a+"="+c._urlEncode(b[a])}).join("&")},a.prototype._getSignature=function(a,b){var c,d=this;return c=this._map(a,function(a){return""+a+"="+d._sigEncode(b[a])}).join("")+this.api_secret,CryptoJS.MD5(c)},a.prototype._urlEncode=function(a){return encodeURIComponent(Array.isArray(a)?JSON.stringify(a):a)},a.prototype._sigEncode=function(a){return Array.isArray(a)?JSON.stringify(a):a},a.prototype._timeout=function(){return Math.round((new Date).getTime()/1e3)+this.timeout_after},a.prototype._map=function(a,b){var c,d,e,f;for(c=[],e=0,f=a.length;f>e;e++)d=a[e],c.push(b(d));return c},a.prototype._keys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},a.prototype._without=function(a,b){return a.filter(function(a){return a!==b})},a.prototype._extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},a.prototype._getNewRequestNumber=function(){return this._requestNumber++},a}();"object"!=typeof window&&"function"==typeof require&&(module.exports=MixpanelExport);