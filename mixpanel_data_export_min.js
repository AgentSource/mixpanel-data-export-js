var MixpanelExport=function(){function e(e){this.opts=e;if(!(this.opts.api_key&&this.opts.api_secret)){throw"Error: api_key and api_secret must be passed to MixpanelExport constructor."}this.api_key=this.opts.api_key;this.api_secret=this.opts.api_secret;this.api_stub=this.opts.api_stub||"http://mixpanel.com/api/2.0/";this.timeout_after=this.opts.timeout_after||10}e.prototype.events=function(e,t){return this.get("events",e,t)};e.prototype.topEvents=function(e,t){return this.get(["events","top"],e,t)};e.prototype.names=function(e,t){return this.get(["events","names"],e,t)};e.prototype.properties=function(e,t){return this.get(["events","properties"],e,t)};e.prototype.topProperties=function(e,t){return this.get(["events","properties","top"],e,t)};e.prototype.values=function(e,t){return this.get(["events","properties","values"],e,t)};e.prototype.funnels=function(e,t){return this.get(["funnels"],e,t)};e.prototype.list=function(e,t){return this.get(["funnels","list"],e,t)};e.prototype.segmentation=function(e,t){return this.get(["segmentation"],e,t)};e.prototype.numeric=function(e,t){return this.get(["segmentation","numeric"],e,t)};e.prototype.sum=function(e,t){return this.get(["segmentation","sum"],e,t)};e.prototype.average=function(e,t){return this.get(["segmentation","average"],e,t)};e.prototype.retention=function(e,t){return this.get(["retention"],e,t)};e.prototype.engage=function(e,t){return this.get(["engage"],e,t)};e.prototype.get=function(e,t,n){if(typeof window==="object"){var r=this._buildRequestURL(e,t)+"&callback=mpSuccess";window.mpSuccess=n;var i=document.createElement("script");i.src=r;document.getElementsByTagName("head")[0].appendChild(i)}else{var r=this._buildRequestURL(e,t);var s=new XMLHttpRequest;var o=function(){result=JSON.parse(this.responseText);n(result)};s.onload=o;s.open("get",r,true);s.send()}};e.prototype._buildRequestURL=function(e,t){return""+this.api_stub+((typeof e.join==="function"?e.join("/"):void 0)||e)+"/?"+this._requestParameterString(t)};e.prototype._requestParameterString=function(e){var t,n,r;t=this._extend({api_key:this.api_key,expire:this._timeout()},e);n=this._keys(t).sort();r=this._without(n,"callback");return this._getParameterString(n,t)+"&sig="+this._getSignature(r,t)};e.prototype._getParameterString=function(e,t){var n=this;return this._map(e,function(e){return""+e+"="+n._urlEncode(t[e])}).join("&")};e.prototype._getSignature=function(e,t){var n,r=this;n=this._map(e,function(e){return""+e+"="+r._sigEncode(t[e])}).join("")+this.api_secret;return CryptoJS.MD5(n)};e.prototype._urlEncode=function(e){if(Array.isArray(e)){return encodeURIComponent(JSON.stringify(e))}else{return encodeURIComponent(e)}};e.prototype._sigEncode=function(e){if(Array.isArray(e)){return JSON.stringify(e)}else{return e}};e.prototype._timeout=function(){return Math.round((new Date).getTime()/1e3)+this.timeout_after};e.prototype._map=function(e,t){var n,r,i,s;n=[];for(i=0,s=e.length;i<s;i++){r=e[i];n.push(t(r))}return n};e.prototype._keys=function(e){var t,n;n=[];for(t in e){n.push(t)}return n};e.prototype._without=function(e,t){return e.filter(function(e){return e!==t})};e.prototype._extend=function(e,t){var n,r;for(n in t){r=t[n];e[n]=r}return e};return e}()