if("object"!=typeof window&&"function"==typeof require)var CryptoJS=require("cryptojs").Crypto,XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest;var MixpanelExport=function(){function a(a){if(this.opts=a,!this.opts.api_key||!this.opts.api_secret)throw"Error: api_key and api_secret must be passed to MixpanelExport constructor.";this.api_key=this.opts.api_key,this.api_secret=this.opts.api_secret,this.api_stub=this.opts.api_stub||"http://mixpanel.com/api/2.0/",this.timeout_after=this.opts.timeout_after||10,this._requestNumber=0}return a.prototype.events=function(a,b){return this.get("events",a,b)},a.prototype.topEvents=function(a,b){return this.get(["events","top"],a,b)},a.prototype.names=function(a,b){return this.get(["events","names"],a,b)},a.prototype.properties=function(a,b){return this.get(["events","properties"],a,b)},a.prototype.topProperties=function(a,b){return this.get(["events","properties","top"],a,b)},a.prototype.values=function(a,b){return this.get(["events","properties","values"],a,b)},a.prototype.funnels=function(a,b){return this.get(["funnels"],a,b)},a.prototype.list=function(a,b){return this.get(["funnels","list"],a,b)},a.prototype.segmentation=function(a,b){return this.get(["segmentation"],a,b)},a.prototype.numeric=function(a,b){return this.get(["segmentation","numeric"],a,b)},a.prototype.sum=function(a,b){return this.get(["segmentation","sum"],a,b)},a.prototype.average=function(a,b){return this.get(["segmentation","average"],a,b)},a.prototype.retention=function(a,b){return this.get(["retention"],a,b)},a.prototype.engage=function(a,b){return this.get(["engage"],a,b)},a.prototype.get=function(a,b,c){if("object"==typeof window){var d=this._getNewRequestNumber(),e=this._buildRequestURL(a,b)+"&callback=mpSuccess"+d;window["mpSuccess"+d]=c;var f=document.createElement("script");f.src=e,document.getElementsByTagName("head")[0].appendChild(f)}else{var e=this._buildRequestURL(a,b),g=new XMLHttpRequest,h=function(){result=JSON.parse(this.responseText),c(result)};g.onload=h,g.open("get",e,!0),g.send()}},a.prototype._buildRequestURL=function(a,b){return""+this.api_stub+(("function"==typeof a.join?a.join("/"):void 0)||a)+"/?"+this._requestParameterString(b)},a.prototype._requestParameterString=function(a){var b,c,d;return b=this._extend({api_key:this.api_key,expire:this._timeout()},a),c=this._keys(b).sort(),d=this._without(c,"callback"),this._getParameterString(c,b)+"&sig="+this._getSignature(d,b)},a.prototype._getParameterString=function(a,b){var c=this;return this._map(a,function(a){return""+a+"="+c._urlEncode(b[a])}).join("&")},a.prototype._getSignature=function(a,b){var c,d=this;return c=this._map(a,function(a){return""+a+"="+d._sigEncode(b[a])}).join("")+this.api_secret,CryptoJS.MD5(c)},a.prototype._urlEncode=function(a){return encodeURIComponent(Array.isArray(a)?JSON.stringify(a):a)},a.prototype._sigEncode=function(a){return Array.isArray(a)?JSON.stringify(a):a},a.prototype._timeout=function(){return Math.round((new Date).getTime()/1e3)+this.timeout_after},a.prototype._map=function(a,b){var c,d,e,f;for(c=[],e=0,f=a.length;f>e;e++)d=a[e],c.push(b(d));return c},a.prototype._keys=function(a){var b,c;c=[];for(b in a)c.push(b);return c},a.prototype._without=function(a,b){return a.filter(function(a){return a!==b})},a.prototype._extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},a.prototype._getNewRequestNumber=function(){return this._requestNumber++},a}();"object"!=typeof window&&"function"==typeof require&&(module.exports=MixpanelExport);