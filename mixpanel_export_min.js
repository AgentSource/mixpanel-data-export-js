var MixpanelExport;MixpanelExport=function(){function t(t){if(this.opts=t,!this.opts.api_key||!this.opts.api_secret)throw"Error: api_key and api_secret must be passed to Mixpanel constructor.";this.api_key=this.opts.api_key,this.api_secret=this.opts.api_secret,this.api_stub="//mixpanel.com/api/2.0/",this.timeout_after=10}return t.prototype.events=function(t){return this.get("events",t)},t.prototype.top_events=function(t){return this.get(["events","top"],t)},t.prototype.names=function(t){return this.get(["events","names"],t)},t.prototype.properties=function(t){return this.get(["events","properties"],t)},t.prototype.top_properties=function(t){return this.get(["events","properties","top"],t)},t.prototype.values=function(t){return this.get(["events","properties","values"],t)},t.prototype.funnels=function(t){return this.get(["funnels"],t)},t.prototype.list=function(t){return this.get(["funnels","list"],t)},t.prototype.segmentation=function(t){return this.get(["segmentation"],t)},t.prototype.numeric=function(t){return this.get(["segmentation","numeric"],t)},t.prototype.sum=function(t){return this.get(["segmentation","sum"],t)},t.prototype.average=function(t){return this.get(["segmentation","average"],t)},t.prototype.retention=function(t){return this.get(["retention"],t)},t.prototype.engage=function(t){return this.get(["engage"],t)},t.prototype.get=function(t,e){var i;return i={request_url:this._build_request_url(t,e),req:new XMLHttpRequest,done:function(){throw"[MixpanelExport] You must implement the .done(json) method on the result of your API call!"},get:function(){var t=this;return this.req.open("get",this.request_url,!0),this.req.onload=function(){return i=JSON.parse(t.req.responseText),t.done(i)},this.req.send()}},i.get(),i},t.prototype._build_request_url=function(t,e){return""+this.api_stub+(("function"==typeof t.join?t.join("/"):void 0)||t)+"/?"+this._request_parameter_string(e)},t.prototype._request_parameter_string=function(t){var e,i,s;return e=this._extend({api_key:this.api_key,expire:this._timeout(),callback:""},t),i=this._keys(e).sort(),s=this._without(i,"callback"),this._get_parameter_string(i,e)+"&sig="+this._get_signature(s,e)},t.prototype._get_parameter_string=function(t,e){var i=this;return this._map(t,function(t){return""+t+"="+i._url_encode(e[t])}).join("&")},t.prototype._get_signature=function(t,e){var i,s=this;return i=this._map(t,function(t){return""+t+"="+s._sig_encode(e[t])}).join("")+this.api_secret,CryptoJS.MD5(i)},t.prototype._url_encode=function(t){return Array.isArray(t)?encodeURIComponent(JSON.stringify(t)):t},t.prototype._sig_encode=function(t){return Array.isArray(t)?JSON.stringify(t):t},t.prototype._timeout=function(){return Math.round((new Date).getTime()/1e3)+this.timeout_after},t.prototype._map=function(t,e){var i,s,r,n;for(i=[],r=0,n=t.length;n>r;r++)s=t[r],i.push(e(s));return i},t.prototype._keys=function(t){var e,i;i=[];for(e in t)i.push(e);return i},t.prototype._without=function(t,e){return t.filter(function(t){return t!==e})},t.prototype._extend=function(t,e){var i,s;for(i in e)s=e[i],t[i]=s;return t},t}();